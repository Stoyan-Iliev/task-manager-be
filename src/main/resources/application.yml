spring:
  application:
    name: jira-backend
  datasource:
    url: jdbc:postgresql://localhost:5432/taskmanager
    driver-class-name: org.postgresql.Driver
    username: postgres
    password: postgres
    hikari:
      pool-name: TaskManagerHikariPool
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      auto-commit: true
      connection-test-query: SELECT 1
      leak-detection-threshold: 60000
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
    open-in-view: false
  flyway:
    enabled: true

management:
  endpoints:
    web:
      exposure:
        include: health,info

server:
  port: 8080

security:
  jwt:
    issuer: "http://localhost:8080"
    audience: ["web"]
    access-token-ttl: PT15M
    refresh-token-ttl: P14D
    clock-skew: PT60S
    refresh-hmac-secret: <REFRESH_HMAC_SECRET>
    key:
      type: pem # pem | keystore
      pem-public: [] # e.g. ["classpath:jwt/dev-public.pem"]
      pem-private: [] # e.g. ["classpath:jwt/dev-private.pem"]
      keystore-location: <CLASSPATH_OR_PATH>
      keystore-alias: <ALIAS>
      keystore-password: <KEYSTORE_PASSWORD>
      current-kid:
  limits:
    login-max-per-minute: 5
    refresh-max-per-minute: 20
  encryption:
    # AES-256 encryption key for sensitive data (Git tokens, etc.)
    # IMPORTANT: Change this in production! Use a strong random key (32+ chars)
    key: "dev-encryption-key-change-in-production-32chars-minimum"

cors:
  allowed-origins: ["http://localhost:3000", "http://localhost:5173"]
  allowed-methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  allowed-headers: ["Authorization", "Content-Type", "Cache-Control", "Pragma", "X-Requested-With"]

storage:
  s3:
    endpoint: http://localhost:9000
    access-key: minioadmin
    secret-key: minioadmin123
    bucket-name: taskmanager-attachments
    region: us-east-1
    max-file-size-bytes: 52428800  # 50 MB
    allowed-mime-types:
      - image/jpeg
      - image/png
      - image/gif
      - image/webp
      - application/pdf
      - application/msword
      - application/vnd.openxmlformats-officedocument.wordprocessingml.document
      - application/vnd.ms-excel
      - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
      - text/plain
      - text/csv
      - application/json
      - application/zip

app:
  email:
    sendgrid:
      # SendGrid API key for email delivery
      # Get your API key from: https://app.sendgrid.com/settings/api_keys
      # Set via environment variable: SENDGRID_API_KEY
      api-key: ${SENDGRID_API_KEY:your-sendgrid-api-key-here}
    from:
      # Sender email address (must be verified in SendGrid)
      address: ${EMAIL_FROM_ADDRESS:notifications@taskmanager.com}
      # Sender display name
      name: ${EMAIL_FROM_NAME:Task Manager}
    digest:
      # Enable/disable email digest scheduler
      enabled: ${EMAIL_DIGEST_ENABLED:true}
    retry:
      # Enable/disable failed email retry scheduler
      enabled: ${EMAIL_RETRY_ENABLED:true}
      # Maximum retry attempts before marking as permanently failed
      max-attempts: ${EMAIL_RETRY_MAX_ATTEMPTS:3}
      # Initial delay before first retry (in minutes)
      initial-delay-minutes: ${EMAIL_RETRY_INITIAL_DELAY:5}
      # Backoff multiplier for exponential retry (5min, 10min, 20min)
      backoff-multiplier: ${EMAIL_RETRY_BACKOFF_MULTIPLIER:2}
  frontend:
    # Frontend base URL for task links in emails
    base-url: ${FRONTEND_BASE_URL:http://localhost:5173}
  notifications:
    # Number of days to retain read notifications before cleanup
    retention-days: ${NOTIFICATION_RETENTION_DAYS:30}
